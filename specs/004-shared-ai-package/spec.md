# 기능 명세서: Shared AI Package

**기능 브랜치**: `004-shared-ai-package`
**생성일**: 2026-01-11
**상태**: 초안
**입력**: "AI 기능이 여기저기서 사용되는데, AI와 소통하는 방법을 추출해서 별도의 package로 만든뒤 사용하는 것이 모노레포의 장점을 살리는 방법일 것 같습니다. AI와 소통하기 위한 패키지를 추출하고 일단 GEMINI와 OPEN_AI 용 기능을 추가하세요."

## 사용자 시나리오 및 테스트 *(필수)*

### 사용자 스토리 1 - 통합된 AI 클라이언트 (우선순위: P1)

개발자로서, 나는 다양한 AI 제공자(OpenAI, Gemini)를 동일한 인터페이스로 호출할 수 있는 통합된 패키지를 사용하여, 애플리케이션의 다른 부분에서 AI 기능을 쉽게 구현하고 유지보수하고 싶다.

**이 우선순위인 이유**: 모노레포 내에서 중복 코드를 줄이고 AI 로직을 중앙에서 관리하기 위함이다.

**독립적 테스트**: 패키지를 임포트(import)하여 OpenAI와 Gemini 모델 각각에 대해 간단한 텍스트 생성 요청을 보내고, 성공적으로 응답을 받는지 테스트 코드로 검증한다.

**인수 시나리오**:

1.  **Given** 유효한 OpenAI API 키와 Gemini API 키가 설정되어 있을 때, **When** 통합 클라이언트를 통해 OpenAI 모델에 요청을 보내면, **Then** 올바른 텍스트 응답을 받아야 한다.
2.  **Given** 통합 클라이언트를 통해 Gemini 모델에 요청을 보내면, **Then** 올바른 텍스트 응답을 받아야 한다.
3.  **Given** 지원하지 않는 모델이나 잘못된 설정을 사용하면, **Then** 명확한 에러를 반환해야 한다.

### 사용자 스토리 2 - 확장 가능한 구조 (우선순위: P2)

개발자로서, 나는 새로운 AI 모델이나 제공자가 추가되더라도 기존 코드를 크게 수정하지 않고 통합 패키지를 확장할 수 있는 구조를 원한다.

**이 우선순위인 이유**: 빠르게 변화하는 AI 생태계에 유연하게 대응하기 위함이다.

**독립적 테스트**: 새로운 가상의 제공자(Mock Provider)를 추가하여 기존 클라이언트 코드의 변경 없이 작동하는지 단위 테스트로 검증한다.

## 요구사항 *(필수)*

### 기능적 요구사항

- **FR-001**: `packages/ai` (또는 유사한 경로)에 새로운 npm 패키지를 생성해야 한다.
- **FR-002**: OpenAI API를 호출할 수 있는 기능을 제공해야 한다 (GPT-4o, GPT-3.5 등 지원).
- **FR-003**: Google Gemini API를 호출할 수 있는 기능을 제공해야 한다 (Gemini 1.5 The Flash/Pro 등 지원).
- **FR-004**: 두 제공자 모두에 대해 **통일된 인터페이스**(예: `generateText`, `generateStream`)를 제공해야 한다.
- **FR-005**: 스트리밍 응답을 지원해야 한다.
- **FR-006**: API 키 및 설정은 환경 변수나 설정 객체를 통해 주입받을 수 있어야 한다.

### 비기능적 요구사항

- **NFR-001**: TypeScript로 작성되어야 하며 강력한 타입 정의를 제공해야 한다.
- **NFR-002**: 의존성을 최소화하고, 필요한 SDK(openai, google-generative-ai 등)만 포함해야 한다.
- **NFR-003**: 적절한 에러 처리(Error Handling)가 포함되어야 한다 (예: 타임아웃, 재시도 등).

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: `packages/ai` 패키지가 린트(Lint) 및 빌드(Build)를 통과해야 한다.
- **SC-002**: OpenAI와 Gemini 각각에 대한 통합 테스트가 성공해야 한다.
- **SC-003**: `apps/server` 또는 다른 앱에서 이 패키지를 의존성으로 추가하여 사용할 수 있어야 한다.
