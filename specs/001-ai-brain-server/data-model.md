# Data Model for AI Brain Server

This document defines the core data entities for the AI Brain Server, based on the feature specification. These entities will be used to structure the data stored by the application, although `KnowledgeChunk` resides in a vector store, not a traditional relational database.

## Entity: Interaction

Represents a single exchange between a user and an external AI tool, which is logged by the server.

| Field | Type | Description | Required |
|---|---|---|---|
| `id` | `string` (UUID) | Unique identifier for the interaction. | Yes |
| `user_context` | `JSONB` | A flexible JSON object containing contextual information from the user's tool (e.g., current file path, selected code). | No |
| `original_query` | `text` | The original query or prompt sent to the AI. | Yes |
| `ai_response` | `text` | The response generated by the AI tool. | Yes |
| `timestamp` | `datetime` | The time when the interaction was logged. | Yes |

### Example

```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "user_context": {
    "file": "/src/index.ts",
    "language": "typescript"
  },
  "original_query": "How do I map over an array in TS?",
  "ai_response": "You can use the .map() function...",
  "timestamp": "2026-01-10T14:30:00Z"
}
```

---

## Entity: Feedback

Represents the user's evaluation of a logged `Interaction`.

| Field | Type | Description | Required |
|---|---|---|---|
| `id` | `string` (UUID) | Unique identifier for the feedback entry. | Yes |
| `interaction_id` | `string` (FK) | A reference to the `Interaction` this feedback is for. | Yes |
| `rating` | `string` | The user's rating. Must be one of: `"positive"`, `"negative"`. | Yes |
| `correction` | `text` | Optional corrective text or additional information provided by the user. | No |
| `timestamp` | `datetime` | The time when the feedback was submitted. | Yes |

### Example

```json
{
  "id": "b2c3d4e5-f6a7-8901-2345-67890abcdef1",
  "interaction_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "rating": "positive",
  "correction": null,
  "timestamp": "2026-01-10T14:32:10Z"
}
```

---

## Entity: KnowledgeChunk

Represents a piece of information stored in the FAISS vector store. This is a conceptual model, as the exact structure depends on the `langchain/faiss-node` implementation.

| Field | Type | Description |
|---|---|---|
| `id` | `string` | A unique identifier for the chunk. |
| `content` | `text` | The actual text content of the knowledge chunk. |
| `vector` | `float[]` | The numerical vector representation of the content. |
| `metadata` | `JSONB` | A flexible field to store metadata, such as the source of the information, ingestion timestamp, etc. |

### Example Metadata

```json
{
  "source": "manual_input_20260110_150000",
  "ingested_at": "2026-01-10T15:00:00Z",
  "retrieval_score_modifier": 1.05
}
```
